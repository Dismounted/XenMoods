<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="xenmoods" title="XenMoods" version_string="1.0.2" version_id="3" url="http://xenforo.com/community/threads/xenmoods.5885/" install_callback_class="XenMoods_Install" install_callback_method="install" uninstall_callback_class="XenMoods_Uninstall" uninstall_callback_method="uninstall">
  <admin_navigation>
    <navigation navigation_id="moods" parent_navigation_id="options" display_order="20" link="moods" admin_permission_id="mood" debug_only="0" hide_no_children="0"/>
  </admin_navigation>
  <admin_permissions>
    <admin_permission admin_permission_id="mood" display_order="1"/>
  </admin_permissions>
  <admin_style_properties/>
  <admin_templates>
    <template title="mood_delete"><![CDATA[<xen:title>{xen:phrase confirm_deletion_of_mood}: {$mood.title}</xen:title>
<xen:h1>{xen:phrase confirm_deletion_of_mood}</xen:h1>

<xen:navigation>
	<xen:breadcrumb href="{xen:adminlink 'moods/edit', $mood}">{$mood.title}</xen:breadcrumb>
</xen:navigation>

<xen:require css="delete_confirmation.css" />

<xen:form action="{xen:adminlink 'moods/delete', $mood}" class="deleteConfirmForm">
	<p>{xen:phrase please_confirm_that_you_want_to_delete_following_mood}:</p>
	<strong><a href="{xen:adminlink 'moods/edit', $mood}">{$mood.title}</a></strong>
	<p>{xen:phrase all_users_will_move_to_default_mood}</p>

	<xen:submitunit save="{xen:phrase delete_mood}" />

	<input type="hidden" name="_xfConfirm" value="1" />
</xen:form>]]></template>
    <template title="mood_edit"><![CDATA[<xen:title>{xen:if '{$mood.mood_id}', '{xen:phrase edit_mood}: {$mood.title}', '{xen:phrase create_new_mood}'}</xen:title>

<xen:form class="AutoValidator"
	action="{xen:adminlink 'moods/save', $mood}"
	data-formValidatorUrl="{xen:adminlink 'moods/save.json', $mood}"
	data-fieldValidatorUrl="{xen:adminlink 'moods/validate-field.json', $mood}"
	data-redirect="on">
	
	<xen:textboxunit label="{xen:phrase title}:" name="title" value="{$mood.title}" data-liveTitleTemplate="{xen:if {$mood.mood_id},
		'{xen:phrase edit_mood}: <em>%s</em>',
		'{xen:phrase create_new_mood}: <em>%s</em>'}" />
	<xen:textboxunit label="{xen:phrase mood_image_url}:" name="image_url" value="{$mood.image_url}" />
	
	<xen:submitunit save="{xen:phrase save_mood}">
		<xen:if is="{$mood.mood_id}"><a href="{xen:adminlink 'moods/delete', $mood}" class="button OverlayTrigger">{xen:phrase delete_mood}...</a></xen:if>
	</xen:submitunit>
</xen:form>]]></template>
    <template title="mood_list"><![CDATA[<xen:title>{xen:phrase moods}</xen:title>

<xen:topctrl><a href="{xen:adminlink moods/add}" class="button">+ {xen:phrase add_new_mood}</a></xen:topctrl>

<xen:require css="filter_list.css" />
<xen:require js="js/xenforo/filter_list.js" />

<xen:form action="{xen:adminlink moods}" class="section">
	<xen:if is="{$moods}">
		<h2 class="subHeading">
			<xen:include template="filter_list_controls" />
			{xen:phrase moods}
		</h2>
		<ol class="FilterList">
			<xen:foreach loop="$moods" value="$mood">
				<xen:listitem
					id="{$mood.mood_id}"
					label="{$mood.title}"
					href="{xen:adminlink 'moods/edit', $mood}"
					linkstyle="padding-left: 110px; background-image: url('{$mood.image_url}')"
					snippet="{xen:if {$mood.is_default}, {xen:phrase default}}"
					delete="{xen:adminlink 'moods/delete', $mood}">
					<xen:html>
						<xen:if is="!{$mood.is_default}">
							<a href="{xen:adminlink 'moods/make-default', $mood}" class="secondaryContent OverlayTrigger">{xen:phrase make_default_mood}</a>
						</xen:if>
					</xen:html>
				</xen:listitem>
			</xen:foreach>
		</ol>

		<p class="sectionFooter">{xen:phrase showing_x_of_y_items, 'count=<span class="FilterListCount">{xen:count $moods}</span>', 'total={xen:count $moods}'}</p>

	<xen:else />
		<div class="noResults">{xen:phrase no_moods_have_been_added_yet}</div>
	</xen:if>
</xen:form>]]></template>
    <template title="mood_make_default"><![CDATA[<xen:title>{xen:phrase confirm_selection_default_mood}: {$mood.title}</xen:title>
<xen:h1>{xen:phrase confirm_selection_default_mood}</xen:h1>

<xen:navigation>
	<xen:breadcrumb href="{xen:adminlink 'moods/edit', $mood}">{$mood.title}</xen:breadcrumb>
</xen:navigation>

<xen:require css="delete_confirmation.css" />

<xen:form action="{xen:adminlink 'moods/make-default', $mood}" class="deleteConfirmForm">
	<p>{xen:phrase please_confirm_that_you_want_to_mark_following_mood_default}:</p>
	<strong><a href="{xen:adminlink 'moods/edit', $mood}">{$mood.title}</a></strong>

	<xen:submitunit save="{xen:phrase make_default_mood}" />

	<input type="hidden" name="_xfConfirm" value="1" />
</xen:form>]]></template>
  </admin_templates>
  <code_events/>
  <code_event_listeners>
    <listener event_id="front_controller_pre_view" execute_order="10" callback_class="XenMoods_Listener_FrontControllerPreView" callback_method="init" active="1" description="Injects mood data so that it can be accessed in templates."/>
    <listener event_id="init_dependencies" execute_order="10" callback_class="XenMoods_Listener_InitDependencies" callback_method="init" active="1" description="Pre-loads all moods for use."/>
    <listener event_id="load_class_model" execute_order="10" callback_class="XenMoods_Listener_LoadClassModel" callback_method="init" active="1" description="Extends XenForo models with XenMoods-specific methods."/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <optiongroups/>
  <permissions>
    <permission_groups>
      <permission_group permission_group_id="mood"/>
    </permission_groups>
    <permissions>
      <permission permission_group_id="mood" permission_id="have" permission_type="flag" depend_permission_id="view" default_value="allow" interface_group_id="moodPermissions" display_order="20"/>
      <permission permission_group_id="mood" permission_id="view" permission_type="flag" default_value="allow" interface_group_id="moodPermissions" display_order="10"/>
    </permissions>
    <interface_groups>
      <interface_group interface_group_id="moodPermissions" display_order="300"/>
    </interface_groups>
  </permissions>
  <phrases>
    <phrase title="add_new_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Add New Mood]]></phrase>
    <phrase title="admin_navigation_moods" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Moods]]></phrase>
    <phrase title="admin_permission_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Can Manage Moods]]></phrase>
    <phrase title="all_users_will_move_to_default_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[All users using this mood will automatically switch to the default mood.]]></phrase>
    <phrase title="cannot_delete_default_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[A default mood cannot be deleted. Please assign another mood to be the default before deleting this one.]]></phrase>
    <phrase title="confirm_deletion_of_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Confirm Deletion of Mood]]></phrase>
    <phrase title="confirm_selection_default_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Confirm Selection of Default Mood]]></phrase>
    <phrase title="create_new_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Create New Mood]]></phrase>
    <phrase title="delete_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Delete Mood]]></phrase>
    <phrase title="edit_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Edit Mood]]></phrase>
    <phrase title="make_default_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Make Default]]></phrase>
    <phrase title="moods" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Moods]]></phrase>
    <phrase title="mood_chooser" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Mood Chooser]]></phrase>
    <phrase title="mood_image_url" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Mood Image URL]]></phrase>
    <phrase title="no_moods_have_been_added_yet" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[No moods have been added yet.]]></phrase>
    <phrase title="permission_group_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Mood Permissions]]></phrase>
    <phrase title="permission_interface_moodPermissions" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Mood Permissions]]></phrase>
    <phrase title="permission_mood_have" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Can Have Mood]]></phrase>
    <phrase title="permission_mood_view" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Can View Moods]]></phrase>
    <phrase title="please_confirm_that_you_want_to_delete_following_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Please confirm that you want to delete the following mood]]></phrase>
    <phrase title="please_confirm_that_you_want_to_mark_following_mood_default" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Please confirm that you want to mark the following mood as default]]></phrase>
    <phrase title="please_select_valid_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Please select a valid mood.]]></phrase>
    <phrase title="requested_mood_not_found" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[The requested mood could not be found.]]></phrase>
    <phrase title="save_mood" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Save Mood]]></phrase>
    <phrase title="select_mood_you_are_currently_in" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Select the mood you are currently in]]></phrase>
    <phrase title="style_property_editorShowMood_description_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Display a user's mood under his/her avatar next to the quick reply editor.]]></phrase>
    <phrase title="style_property_editorShowMood_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Show User Mood on QR Editor]]></phrase>
    <phrase title="style_property_headerShowMood_description_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Displays a user's mood in the user drop-down menu.]]></phrase>
    <phrase title="style_property_headerShowMood_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Show User Mood]]></phrase>
    <phrase title="style_property_memberCardShowMood_description_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Displays a user's mood on their member card pop-up.]]></phrase>
    <phrase title="style_property_memberCardShowMood_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Show User Mood on Member Card]]></phrase>
    <phrase title="style_property_messageShowMood_description_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Display the mood of the message author.]]></phrase>
    <phrase title="style_property_messageShowMood_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Show Author Mood]]></phrase>
    <phrase title="style_property_profileShowMood_description_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Displays a user's mood on their profile.]]></phrase>
    <phrase title="style_property_profileShowMood_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Show User Mood on Profile]]></phrase>
    <phrase title="style_property_sidebarShowMood_description_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Displays a user's mood in the sidebar block under "Signed in as" on the forum index.]]></phrase>
    <phrase title="style_property_sidebarShowMood_master" global_cache="0" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[Show User Mood on Sidebar]]></phrase>
  </phrases>
  <route_prefixes>
    <route_type type="admin">
      <prefix original_prefix="moods" class="XenMoods_Route_PrefixAdmin_Moods" build_link="data_only"/>
    </route_type>
    <route_type type="public">
      <prefix original_prefix="moods" class="XenMoods_Route_Prefix_Moods" build_link="none"/>
    </route_type>
  </route_prefixes>
  <style_properties>
    <property property_name="messageShowMood" property_type="scalar" definition="1" group_name="messageUserInfo" title="Show Author Mood" description="Display the mood of the message author." css_components="" scalar_type="boolean" scalar_parameters="" display_order="100" sub_group="User Info"><![CDATA[1]]></property>
    <property property_name="headerShowMood" property_type="scalar" definition="1" group_name="header" title="Show User Mood" description="Displays a user's mood in the user drop-down menu." css_components="" scalar_type="boolean" scalar_parameters="" display_order="100" sub_group="XenMoods"><![CDATA[1]]></property>
    <property property_name="sidebarShowMood" property_type="scalar" definition="1" group_name="options" title="Show User Mood on Sidebar" description="Displays a user's mood in the sidebar block under &quot;Signed in as&quot; on the forum index." css_components="" scalar_type="boolean" scalar_parameters="" display_order="100" sub_group="XenMoods"><![CDATA[1]]></property>
    <property property_name="editorShowMood" property_type="scalar" definition="1" group_name="options" title="Show User Mood on QR Editor" description="Display a user's mood under his/her avatar next to the quick reply editor." css_components="" scalar_type="boolean" scalar_parameters="" display_order="110" sub_group="XenMoods"><![CDATA[1]]></property>
    <property property_name="profileShowMood" property_type="scalar" definition="1" group_name="options" title="Show User Mood on Profile" description="Displays a user's mood on their profile." css_components="" scalar_type="boolean" scalar_parameters="" display_order="120" sub_group="XenMoods"><![CDATA[1]]></property>
    <property property_name="memberCardShowMood" property_type="scalar" definition="1" group_name="options" title="Show User Mood on Member Card" description="Displays a user's mood on their member card pop-up." css_components="" scalar_type="boolean" scalar_parameters="" display_order="130" sub_group="XenMoods"><![CDATA[1]]></property>
  </style_properties>
  <templates>
    <template title="mood_chooser" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[<xen:title>{xen:phrase mood_chooser}</xen:title>

<xen:require css="chooser_overlay.css" />
<xen:require css="mood_chooser.css" />

<div class="section moodChooser" data-overlayClass="chooserOverlay">

	<h3 class="subHeading">{xen:phrase select_mood_you_are_currently_in}</h3>

	<ol class="primaryContent chooserColumns threeColumns">

		<xen:foreach loop="$moods" key="$moodId" value="$mood">
			<li{xen:if "{$selected} == '{$mood.mood_id}'", ' class="currentMood"'}>
				<a href="{xen:link 'moods/mood-chooser', '', 'mood_id={$mood.mood_id}', '_xfToken={$visitor.csrf_token_page}', 'redirect={$redirect}'}">
					<img src="{$mood.image_url}" alt="{$mood.title}" />
				</a>
			</li>
		</xen:foreach>

	</ol>

	<div class="sectionFooter overlayOnly"><a class="button primary OverlayCloser">{xen:phrase cancel}</a></div>
</div>]]></template>
    <template title="mood_chooser.css" version_id="1" version_string="1.0.0"><![CDATA[.moodChooser li img
{
	display: block;
	margin-left: auto;
	margin-right: auto;
}

.moodChooser .currentMood a
{
	background-color: {xen:property primaryLighterStill};
	text-decoration: none;
}

.moodChooser ol
{
	height: 250px;
	overflow: auto;
}]]></template>
    <template title="mood_display" version_id="1" version_string="1.0.0 Beta 1"><![CDATA[<xen:if is="{$canViewMoods}">
	<xen:require css="mood_display.css" />

	<xen:set var="$moodImageUrl">{xen:if "{$user.mood_id}", {$moods.{$user.mood_id}.image_url}, {$moods.{$defaultMoodId}.image_url}}</xen:set>

	<div class="userMood">
		<xen:if is="{$visitor.user_id} == {$user.user_id} && {$canHaveMood}">
			<a href="{xen:link moods/mood-chooser, '', 'selected={$user.mood_id}', 'redirect={$requestPaths.requestUri}'}" class="OverlayTrigger Tooltip" title="{xen:phrase mood_chooser}" data-offsetY="-8">
				<img src="{$moodImageUrl}" alt="{$moods.{$user.mood_id}.title}" />
			</a>
		<xen:else />
			<img src="{$moodImageUrl}" alt="{$moods.{$user.mood_id}.title}" />
		</xen:if>
	</div>
</xen:if>]]></template>
    <template title="mood_display.css" version_id="2" version_string="1.0.1"><![CDATA[.userMood
{
	padding-top: 10px;
}

.userInfo .userMood, .profilePage .userMood
{
	float: right;
}

.avatarHolder .userMood img
{
	display: block;
	margin-left: auto;
	margin-right: auto;
}]]></template>
  </templates>
</addon>
